{"version":3,"sources":["../../app-es6/services/NegociacaoService.js"],"names":["NegociacaoService","_http","HttpService","Promise","all","obterNegociacoesDaSemana","obterNegociacoesDaSemanaPassada","obterNegociacoesDaSemanaRetrasada","then","negociacoes","semanas","reduce","retorno","semana","concat","catch","Error","erro","resolve","reject","get","map","Negociacao","Date","objeto","data","quantidade","valor","console","log","negociacao","ConnectionFactory","getConnection","NegociacaoDAO","connection","dao","adiciona","listaTodos","apagaTodos","listaAtual","obterNegociacoes","filter","some","JSON","stringify","negociacaoLista"],"mappings":"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","file":"NegociacaoService.js","sourcesContent":["class NegociacaoService {\r\n\r\n  constructor() {\r\n    this._http = new HttpService();\r\n  }\r\n\r\n  obterNegociacoes() {\r\n    return Promise.all([this.obterNegociacoesDaSemana(), this.obterNegociacoesDaSemanaPassada(),\r\n        this.obterNegociacoesDaSemanaRetrasada()\r\n      ])\r\n      .then(semanas => {\r\n        let negociacoes = semanas.reduce((retorno, semana) =>\r\n          retorno.concat(semana), []);\r\n        return negociacoes;\r\n      })\r\n      .catch(erro => {\r\n        throw new Error(erro)\r\n      });\r\n  }\r\n\r\n\r\n  obterNegociacoesDaSemana() {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      this._http.get(\"negociacoes/semana\")\r\n        .then(negociacoes =>\r\n          resolve(negociacoes.map(objeto =>\r\n            new Negociacao(new Date(objeto.data), objeto.quantidade, objeto.valor)))\r\n        ).catch(erro => {\r\n          console.log(erro);\r\n          reject(\"Não foi possível importar as negociações da semana\");\r\n        })\r\n\r\n    });\r\n  }\r\n  obterNegociacoesDaSemanaPassada() {\r\n    return new Promise((resolve, reject) => {\r\n\r\n      this._http.get(\"negociacoes/anterior\").then(negociacoes =>\r\n        resolve(negociacoes.map(objeto =>\r\n          new Negociacao(new Date(objeto.data), objeto.quantidade, objeto.valor)))\r\n      ).catch(erro => {\r\n        console.log(erro);\r\n        reject(\"Não foi possível importar as negociações da semana passada\");\r\n      })\r\n\r\n    });\r\n  }\r\n  obterNegociacoesDaSemanaRetrasada() {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      this._http.get(\"negociacoes/retrasada\").then(negociacoes =>\r\n        resolve(negociacoes.map(objeto =>\r\n          new Negociacao(new Date(objeto.data), objeto.quantidade, objeto.valor)))\r\n      ).catch(erro => {\r\n        console.log(erro);\r\n        reject(\"Não foi possível importar as negociações da semana retrasada\");\r\n      })\r\n\r\n    });\r\n  }\r\n\r\n  cadastrar(negociacao) {\r\n    return ConnectionFactory\r\n      .getConnection()\r\n      .then(connection => new NegociacaoDAO(connection))\r\n      .then(dao => dao.adiciona(negociacao))\r\n      .then(() => 'Negociação adicionada com sucesso.')\r\n      .catch(() => {\r\n        console.log(erro);\r\n        throw new Error('Não foi possível adicionar a negociação.')\r\n      });\r\n  }\r\n\r\n  lista() {\r\n    return ConnectionFactory\r\n      .getConnection()\r\n      .then(connection => new NegociacaoDAO(connection))\r\n      .then(dao => dao.listaTodos())\r\n      .catch(erro => {\r\n        console.log(erro);\r\n        throw new Error('Não foi possível obter as negociacões.')\r\n      });\r\n  }\r\n\r\n  apagaTodos() {\r\n    return ConnectionFactory\r\n      .getConnection()\r\n      .then(connection => new NegociacaoDAO(connection))\r\n      .then(dao => dao.apagaTodos())\r\n      .then(() => 'Negociações apagadas com sucesso.')\r\n      .catch(erro => {\r\n        console.log(erro);\r\n        throw new Error('Não foi possível apagar as negociações.');\r\n      });\r\n  }\r\n\r\n  importa(listaAtual) {\r\n    return this.obterNegociacoes()\r\n      .then(negociacoes =>\r\n        negociacoes.filter(negociacao =>\r\n          !listaAtual.some(negociacaoLista =>\r\n            JSON.stringify(negociacaoLista) == JSON.stringify(negociacao))))\r\n      .catch(erro => {\r\n        console.log(erro);\r\n        throw new Error('Não foi possível importar as negociações');\r\n      });\r\n  }\r\n\r\n}\r\n"]}