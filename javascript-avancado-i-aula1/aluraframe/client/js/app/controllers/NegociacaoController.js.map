{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Negociacao","Mensagem","NegociacoesView","MensagemView","NegociacaoService","Bind","DateHelper","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","_mensagem","_ordemAtual","_service","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","console","log","erro","texto","setInterval","importaNegociacoes","event","preventDefault","_criaNegociacao","cadastrar","_limparFormulario","mensagem","importa","textoParaData","value","focus","apagaTodos","esvazia","coluna","inverteOrdem","ordena","a","b","negociacaoController","currentInstance"],"mappings":";;;;;;;;;;;;;;;AACEA,sB,2BAAAA,gB;;AAGAC,gB,qBAAAA,U;;AAGAC,c,mBAAAA,Q;;AAGAC,qB,yBAAAA,e;;AAGAC,kB,sBAAAA,Y;;AAGAC,uB,8BAAAA,iB;;AAGAC,U,gBAAAA,I;;AAGAC,gB,sBAAAA,U;;;;;;;;;;;;;;;;;;;;;AAGIC,0B;AAEJ,wCAAc;AAAA;;AACZ,eAAKC,CAAL,GAASC,SAASC,aAAT,CAAuBC,IAAvB,CAA4BF,QAA5B,CAAT;AACA,eAAKG,UAAL,GAAkB,KAAKJ,CAAL,CAAO,OAAP,CAAlB;AACA,eAAKK,gBAAL,GAAwB,KAAKL,CAAL,CAAO,aAAP,CAAxB;AACA,eAAKM,WAAL,GAAmB,KAAKN,CAAL,CAAO,QAAP,CAAnB;;AAEA,eAAKO,iBAAL,GAAyB,IAAIV,IAAJ,CAAS,IAAIN,gBAAJ,EAAT,EAAiC,IAAIG,eAAJ,CAAoB,KAAKM,CAAL,CAAO,kBAAP,CAApB,CAAjC,EAAkF,UAAlF,EAA8F,SAA9F,EAAyG,QAAzG,EAAmH,cAAnH,CAAzB;;AAEA,eAAKQ,SAAL,GAAiB,IAAIX,IAAJ,CAAS,IAAIJ,QAAJ,EAAT,EAAyB,IAAIE,YAAJ,CAAiB,KAAKK,CAAL,CAAO,eAAP,CAAjB,CAAzB,EAAoE,OAApE,CAAjB;;AAEA,eAAKS,WAAL,GAAmB,EAAnB;;AAEA,eAAKC,QAAL,GAAgB,IAAId,iBAAJ,EAAhB;;AAEA,eAAKe,KAAL;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAGD;;;;kCAEO;AAAA;;AACN,iBAAKD,QAAL,CAAcE,KAAd,GACGC,IADH,CACQ;AAAA,qBACJC,YAAYC,OAAZ,CAAoB;AAAA,uBAClB,MAAKR,iBAAL,CAAuBS,QAAvB,CAAgCC,UAAhC,CADkB;AAAA,eAApB,CADI;AAAA,aADR,EAIGC,KAJH,CAIS,gBAAQ;AACbC,sBAAQC,GAAR,CAAYC,IAAZ;AACA,oBAAKb,SAAL,CAAec,KAAf,GAAuBD,IAAvB;AACD,aAPH;;AASAE,wBAAY;AAAA,qBAAM,MAAKC,kBAAL,EAAN;AAAA,aAAZ,EAA6C,IAA7C;AACD;;;mCAEQC,K,EAAO;AAAA;;AACdA,kBAAMC,cAAN;AACA,gBAAIT,aAAa,KAAKU,eAAL,EAAjB;AACA,iBAAKjB,QAAL,CAAckB,SAAd,CAAwBX,UAAxB,EACGJ,IADH,CACQ,oBAAY;AAChB,qBAAKN,iBAAL,CAAuBS,QAAvB,CAAgCC,UAAhC;AACA,qBAAKY,iBAAL;AACA,qBAAKrB,SAAL,CAAec,KAAf,GAAuBQ,QAAvB;AACD,aALH,EAMGZ,KANH,CAMS;AAAA,qBAAQ,OAAKV,SAAL,CAAec,KAAf,GAAuBD,IAA/B;AAAA,aANT;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD;;;+CAGoB;AAAA;;AAEnB,iBAAKX,QAAL,CAAcqB,OAAd,CAAsB,KAAKxB,iBAAL,CAAuBO,WAA7C,EACGD,IADH,CACQ,uBAAe;AACnBC,0BAAYC,OAAZ,CAAoB;AAAA,uBAAc,OAAKR,iBAAL,CAAuBS,QAAvB,CAAgCC,UAAhC,CAAd;AAAA,eAApB;AACA,qBAAKT,SAAL,CAAec,KAAf,GAAuB,qCAAvB;AACD,aAJH,EAKGJ,KALH,CAKS;AAAA,qBAAQ,OAAKV,SAAL,CAAec,KAAf,GAAuBD,IAA/B;AAAA,aALT;;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAED;;;4CAEiB;AAChB,mBAAO,IAAI7B,UAAJ,CAAeM,WAAWkC,aAAX,CAAyB,KAAK5B,UAAL,CAAgB6B,KAAzC,CAAf,EAAgE,KAAK5B,gBAAL,CAAsB4B,KAAtF,EACL,KAAK3B,WAAL,CAAiB2B,KADZ,CAAP;AAED;;;8CAEmB;AAClB,iBAAK7B,UAAL,CAAgB6B,KAAhB,GAAwB,EAAxB;AACA,iBAAK5B,gBAAL,CAAsB4B,KAAtB,GAA8B,CAA9B;AACA,iBAAK3B,WAAL,CAAiB2B,KAAjB,GAAyB,GAAzB;AACA,iBAAK7B,UAAL,CAAgB8B,KAAhB;AACD;;;kCAEO;AAAA;;AAEN,iBAAKxB,QAAL,CAAcyB,UAAd,GACGtB,IADH,CACQ,oBAAY;AAChB,qBAAKL,SAAL,CAAec,KAAf,GAAuBQ,QAAvB;AACA,qBAAKvB,iBAAL,CAAuB6B,OAAvB;AACD,aAJH,EAKGlB,KALH,CAKS;AAAA,qBAAQ,OAAKV,SAAL,CAAec,KAAf,GAAuBD,IAA/B;AAAA,aALT;AAMD;;;iCAEMgB,M,EAAQ;AACb,gBAAIA,UAAU,KAAK5B,WAAnB,EAAgC;AAC9B,mBAAKF,iBAAL,CAAuB+B,YAAvB;AACD,aAFD,MAEO;AACL,mBAAK/B,iBAAL,CAAuBgC,MAAvB,CAA8B,UAACC,CAAD,EAAIC,CAAJ;AAAA,uBAAUD,EAAEH,MAAF,IAAYI,EAAEJ,MAAF,CAAtB;AAAA,eAA9B;AACD;AACD,iBAAK5B,WAAL,GAAmB4B,MAAnB;AACD;;;;;;AAKCK,0B,GAAuB,IAAI3C,oBAAJ,E;AACpB,eAAS4C,eAAT,GAA2B;AAChC,eAAOD,oBAAP;AACD","file":"NegociacaoController.js","sourcesContent":["import {\n  ListaNegociacoes\n} from '../models/ListaNegociacoes';\nimport {\n  Negociacao\n} from '../models/Negociacao';\nimport {\n  Mensagem\n} from '../models/Mensagem';\nimport {\n  NegociacoesView\n} from '../views/NegociacoesView';\nimport {\n  MensagemView\n} from '../views/MensagemView';\nimport {\n  NegociacaoService\n} from '../services/NegociacaoService';\nimport {\n  Bind\n} from '../helpers/Bind';\nimport {\n  DateHelper\n} from '../helpers/DateHelper';\n\nclass NegociacaoController {\n\n  constructor() {\n    this.$ = document.querySelector.bind(document);\n    this._inputData = this.$(\"#data\");\n    this._inputQuantidade = this.$(\"#quantidade\");\n    this._inputValor = this.$(\"#valor\");\n\n    this._listaNegociacoes = new Bind(new ListaNegociacoes(), new NegociacoesView(this.$(\"#negociacoesView\")), 'adiciona', 'esvazia', 'ordena', 'inverteOrdem');\n\n    this._mensagem = new Bind(new Mensagem(), new MensagemView(this.$(\"#mensagemView\")), 'texto');\n\n    this._ordemAtual = '';\n\n    this._service = new NegociacaoService();\n\n    this._init();\n\n    // ConnectionFactory.getConnection()\n    //   .then(connection => {\n    //     new NegociacaoDAO(connection)\n    //       .listaTodos()\n    //       .then(negociacoes => negociacoes.forEach(negociacao => this._listaNegociacoes.adiciona(negociacao)));\n    //   });\n\n\n    // this._listaNegociacoes = new ListaNegociacoes(function(model) {\n    //   this._negociacoesView.update(model);\n    // }.bind(this));\n    // estou usando bind, mas dá pra usar o Reflect.apply, ele pede a função que quero executar\n    // e qual o contexto que essa função deve ser executada\n    //  Dá pra usar a arrow function, o this da => não é dinâmico\n\n\n  }\n\n  _init() {\n    this._service.lista()\n      .then(negociacoes =>\n        negociacoes.forEach(negociacao =>\n          this._listaNegociacoes.adiciona(negociacao)))\n      .catch(erro => {\n        console.log(erro);\n        this._mensagem.texto = erro;\n      });\n\n    setInterval(() => this.importaNegociacoes(), 3000);\n  }\n\n  adiciona(event) {\n    event.preventDefault();\n    let negociacao = this._criaNegociacao();\n    this._service.cadastrar(negociacao)\n      .then(mensagem => {\n        this._listaNegociacoes.adiciona(negociacao);\n        this._limparFormulario();\n        this._mensagem.texto = mensagem;\n      })\n      .catch(erro => this._mensagem.texto = erro);\n\n    // ConnectionFactory\n    //   .getConnection()\n    //   .then(connection => {\n    //     let negociacao = this._criaNegociacao();\n    //     new NegociacaoDAO(connection)\n    //       .adiciona(negociacao)\n    //       .then(() => {\n    //         this._listaNegociacoes.adiciona(this._criaNegociacao());\n    //         this._limparFormulario();\n    //         this._mensagem.texto = \"Negociação adicionada com sucesso\";\n    //       });\n    //   })\n    //   .catch(erro => this._mensagem.texto = erro);\n  }\n\n\n  importaNegociacoes() {\n\n    this._service.importa(this._listaNegociacoes.negociacoes)\n      .then(negociacoes => {\n        negociacoes.forEach(negociacao => this._listaNegociacoes.adiciona(negociacao));\n        this._mensagem.texto = \"Negociações importadas com sucesso.\"\n      })\n      .catch(erro => this._mensagem.texto = erro);\n\n    // Promise.all([service.obterNegociacoesDaSemana(), service.obterNegociacoesDaSemanaPassada(),\n    //     service.obterNegociacoesDaSemanaRetrasada()\n    //   ]).then(arrayNegociacoes => {\n    //     arrayNegociacoes\n    //       .reduce((arrayRetorno, array) => arrayRetorno.concat(array), [])\n    //       .forEach(negociacao => this._listaNegociacoes.adiciona(negociacao))\n    //     this._mensagem.texto = \"Negociações importadas com sucesso.\"\n    //   })\n    //   .catch(erro => this._mensagem.texto = erro);\n\n    // service.obterNegociacoesDaSemana()\n    // .then(negociacoes => {\n    //     negociacoes.forEach(negociacao => this._listaNegociacoes.adiciona(negociacao));\n    //     this._mensagem.texto = \"Negociações importadas com sucesso.\";\n    //   })\n    //   .catch(erro => this._mensagem.texto = erro);\n    // service.obterNegociacoesDaSemanaPassada()\n    // .then(negociacoes => {\n    //     negociacoes.forEach(negociacao => this._listaNegociacoes.adiciona(negociacao));\n    //     this._mensagem.texto = \"Negociações importadas com sucesso.\";\n    //   })\n    //   .catch(erro => this._mensagem.texto = erro);\n    // service.obterNegociacoesDaSemanaRetrasada()\n    // .then(negociacoes => {\n    //     negociacoes.forEach(negociacao => this._listaNegociacoes.adiciona(negociacao));\n    //     this._mensagem.texto = \"Negociações importadas com sucesso.\";\n    //   })\n    //   .catch(erro => this._mensagem.texto = erro);\n\n    // service.obterNegociacoesDaSemana((erro, negociacoes) => {\n    //   if (erro) {\n    //     this._mensagem.texto = erro\n    //     return;\n    //   } else {\n    //     negociacoes.forEach(negociacao => this._listaNegociacoes.adiciona(negociacao));\n    //     this._mensagem.texto = \"Negociações importadas com sucesso.\"\n    //   }\n    // });\n\n  }\n\n  _criaNegociacao() {\n    return new Negociacao(DateHelper.textoParaData(this._inputData.value), this._inputQuantidade.value,\n      this._inputValor.value);\n  }\n\n  _limparFormulario() {\n    this._inputData.value = \"\";\n    this._inputQuantidade.value = 1;\n    this._inputValor.value = 0.0;\n    this._inputData.focus();\n  }\n\n  apaga() {\n\n    this._service.apagaTodos()\n      .then(mensagem => {\n        this._mensagem.texto = mensagem;\n        this._listaNegociacoes.esvazia();\n      })\n      .catch(erro => this._mensagem.texto = erro);\n  }\n\n  ordena(coluna) {\n    if (coluna == this._ordemAtual) {\n      this._listaNegociacoes.inverteOrdem();\n    } else {\n      this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\n    }\n    this._ordemAtual = coluna;\n  }\n\n\n}\n\nlet negociacaoController = new NegociacaoController();\nexport function currentInstance() {\n  return negociacaoController;\n}\n"]}